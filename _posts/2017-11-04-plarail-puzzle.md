---
layout: math
title:  "プラレール線型代数 (2) レールパズル"
---

筑波大学の三谷先生が[プラレールのレールをつなげて閉じたレイアウトを作るパズル][railpuzzle]を公開されています．
非常に面白くて頭を使うので，まだやったことが無いという方はぜひ一度遊んでみてください．

この記事では，前回の[プラレール線型代数]({% post_url 2017-11-03-plarail-linear-algebra %})の考え方を使って，
レールパズルを解く方法を紹介します．
また，画像は[レールパズル][railpuzzle]のスクリーンショットを利用し，一部加工しています．

もちろんですが，**レールパズルのネタバレが含まれています!!** ご注意ください．


それでは具体的に問題を解きながら見ていきます．今回挑戦するのは問題番号40番です．

![レールパズル問題40][puzzle1]

特徴的なのは，S字に6本の曲線レールがつながっていることでしょうか．
この完成途中のレイアウトは，縦横方向のほかに左下方向に長さ6の成分を含んでいます．

![レールパズルに注釈を加えた][puzzle2]

つまり，*右上方向の成分*を持つレールで6つで打ち消しつつ，縦横を合わせれば原点に戻ってこれそうです．

使えるレールは13本，うち6本は向きを合わせるため反時計回りの曲線レールに充てます，
そして残りのうち6本は右上の成分を持つレールを使うため，残りの1本は縦か横につなぎます．

また，基本的に曲線レール用いてななめの成分を作るときは，一度に2本使ってS字レールの単位で作ります．
これはS字に曲線レールを接続すると，端っこの向きが同じ方向になるため扱いが楽であるという理由からです．
そしてこの問題の場合は，ななめに直線レールを敷く時も2本単位で考えればよさそうです．

すると，右上方向の成分を2つ持つレールの組み合わせは次の5種類になります．

![右上，および2種類のS字レール][puzzle3]

![追加で2種類のS字レール][puzzle7]

これらの組み合わせを使ったら繋がりそうです，早速やってみましょう．
ちょっと左に1回行って回りつつS字をはさんで直線を2本っと.....あれ？

![ちょっと失敗][puzzle4]

うーん，も，もう一回やってみましょう，今度は最後のななめの直線2つを上方向のS字にしてみます．

![もう一度失敗][puzzle5]

む，ななめ方向は完全に解消したのにつながらない，でもこれなら途中の横方向を縦に直せば繋がりそうです．

![ようやく完成][puzzle6]

はい，完成です！ななめの成分を考えることで，使うレールの選択肢を狭めて効率的にパズルを解けました．


[railpuzzle]: http://mitani.cs.tsukuba.ac.jp/ja/software/railway_puzzle/index.html
[puzzle1]: {{ "/assets/plarail-puzzle/puzzle1.jpg" | absolute_url }}
[puzzle2]: {{ "/assets/plarail-puzzle/puzzle2.jpg" | absolute_url }}
[puzzle3]: {{ "/assets/plarail-puzzle/puzzle3.jpg" | absolute_url }}
[puzzle4]: {{ "/assets/plarail-puzzle/puzzle4.jpg" | absolute_url }}
[puzzle5]: {{ "/assets/plarail-puzzle/puzzle5.jpg" | absolute_url }}
[puzzle6]: {{ "/assets/plarail-puzzle/puzzle6.jpg" | absolute_url }}
[puzzle7]: {{ "/assets/plarail-puzzle/puzzle7.jpg" | absolute_url }}
